{% extends "base.html" %}

{% block title %}YouTube to Blog - My SEO King Tool{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-md-10">
            
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="h3 fw-bold mb-1">YouTube to Article Converter</h2>
                    <p class="text-muted">Turn any YouTube video into a perfectly formatted SEO blog post.</p>
                </div>
                <div class="bg-white p-2 rounded-circle shadow-sm">
                    <i class="fab fa-youtube fa-2x text-danger"></i>
                </div>
            </div>

            <div class="card shadow-sm mb-4">
                <div class="card-body p-4">
                    <label class="form-label fw-bold">YouTube Video URL</label>
                    <div class="input-group input-group-lg">
                        <input type="text" id="videoUrl" class="form-control" placeholder="https://www.youtube.com/watch?v=...">
                        <button class="btn btn-danger px-5" id="convertBtn" onclick="convertVideo()">
                            <i class="fas fa-magic me-2"></i> Convert
                        </button>
                    </div>
                    <div class="form-text">Works best with videos that have closed captions enabled.</div>
                </div>
            </div>

            <!-- Results -->
            <div id="resultsArea" class="d-none">
                <div class="card shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <span class="fw-bold">Generated Article</span>
                        <div>
                            <button class="btn btn-sm btn-outline-primary me-2" onclick="sendToEditor()">
                                <i class="fas fa-pen me-1"></i> Edit
                            </button>
                            <button class="btn btn-sm btn-outline-dark" onclick="copyText()">Copy</button>
                        </div>
                    </div>
                    <div class="card-body bg-light p-5">
                        <div id="blogOutput" class="bg-white p-5 shadow-sm rounded"></div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
async function convertVideo() {
    const url = document.getElementById('videoUrl').value;
    if(!url) return alert("Enter a URL");

    const btn = document.getElementById('convertBtn');
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Transcribing...';

    try {
        const res = await fetch('/api/youtube-to-blog', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({url: url})
        });
        
        const data = await res.json();
        
        if(data.success) {
            document.getElementById('blogOutput').innerHTML = data.html;
            document.getElementById('resultsArea').classList.remove('d-none');
        } else {
            alert(data.error);
        }
    } catch(e) { console.error(e); alert("Error. Check console."); }
    finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-magic me-2"></i> Convert';
    }
}

function sendToEditor() {
    fetch('/api/save-content', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            title: "YouTube Conversion",
            content: document.getElementById('blogOutput').innerText,
            html_content: document.getElementById('blogOutput').innerHTML,
            keyword: "youtube"
        })
    })
    .then(res => res.json())
    .then(data => {
        if(data.success) window.location.href = `/editor?id=${data.id}`;
    });
}

function copyText() {
    navigator.clipboard.writeText(document.getElementById('blogOutput').innerText);
    alert("Copied!");
}
</script>
{% endblock %}
